- name: Debug write to Sheets (no-create, safe)
  if: always()
  env:
    TARGET_WS: "DEBUG_WRITE"   # ← 바꾸고 싶은 기존 탭 이름으로 설정
  run: |
    python - <<'PY'
    import os, sys, json, gspread
    from google.oauth2.service_account import Credentials
    from datetime import datetime

    SHEET_ID = os.environ["SHEET_ID"]
    TARGET_WS = os.environ.get("TARGET_WS","").strip()
    if not TARGET_WS:
        print("TARGET_WS not set; skip.")
        sys.exit(0)

    # SA 인증
    raw = os.environ["SA_JSON"].strip()
    creds = Credentials.from_service_account_info(
        json.loads(raw),
        scopes=[
            "https://www.googleapis.com/auth/spreadsheets",
            "https://www.googleapis.com/auth/drive",
        ],
    )
    gc = gspread.authorize(creds)
    sh = gc.open_by_key(SHEET_ID)

    # 새로 만들지 않고 정확히 해당 이름의 기존 시트만 찾아 갱신
    try:
        ws = sh.worksheet(TARGET_WS)
    except Exception:
        print(f"[SKIP] Worksheet not found (no-create): '{TARGET_WS}'")
        sys.exit(0)  # 존재하지 않으면 아무것도 안 바꾸고 종료

    # 헤더/구조 변경 없이 특정 셀만 기록 (A1 예시)
    value = [["HELLO_FROM_ACTIONS", datetime.now().isoformat()]]
    ws.update(value, range_name="A1")
    print(f"[OK] Updated '{TARGET_WS}'! {sh.url}")
    PY
